<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiser Clicker: Complete</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        :root {
            --bg-app: #0f172a;
            --bg-panel: #1e293b;
            --bg-input: #334155;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --accent: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --flux: #06b6d4;
            --border: #334155;
        }

        body.true-ascension-mode {
            --bg-app: #1a0505;
            --bg-panel: #2b0a0a;
            --accent: #dc2626;
            --flux: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-app); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 280px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 25px; gap: 20px; }
        .brand { font-size: 1.5rem; font-weight: 800; } .brand span { color: var(--accent); }
        .stats-box { background: var(--bg-input); padding: 15px; border-radius: 10px; }
        .stat-val { font-size: 1.4rem; font-weight: 700; }
        .clicker-container { flex: 1; display: flex; align-items: center; justify-content: center; }
        #click-btn { width: 150px; height: 150px; border-radius: 50%; border: 4px solid var(--accent); background: radial-gradient(circle at 30% 30%, #333, #000); color: white; font-weight: 800; cursor: pointer; transition: 0.1s; }
        #click-btn:active { transform: scale(0.95); }

        /* Main */
        .main-view { flex: 1; padding: 30px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; grid-auto-rows: min-content; }
        
        .card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; font-weight: 700; }
        
        /* Upgrade Lists */
        .upgrade-list { max-height: 300px; overflow-y: auto; }
        .upgrade-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.03); padding: 10px; margin-bottom: 8px; border-radius: 6px; }
        .btn-buy { background: var(--bg-input); color: #aaa; border: none; padding: 6px 12px; border-radius: 4px; cursor: not-allowed; min-width: 70px; }
        .btn-buy.afford { background: var(--accent); color: white; cursor: pointer; }

        /* Special Styles */
        #flux-card.active { border-color: var(--flux); box-shadow: 0 0 15px rgba(6,182,212,0.1); }
        .toggle-btn { width: 100%; padding: 10px; background: transparent; border: 1px solid var(--flux); color: var(--flux); cursor: pointer; border-radius: 6px; margin-bottom: 10px; }
        .toggle-btn.active { background: var(--flux); color: black; }

        #ta-upgrades-card { display: none; border-color: var(--danger); background: rgba(220, 38, 38, 0.05); }
        #ta-btn { background: var(--danger); color: white; width: 100%; padding: 10px; border: none; border-radius: 6px; font-weight: 800; cursor: pointer; margin-top: 10px; display:none; }

        /* Market */
        .market-graph { height: 80px; display: flex; align-items: flex-end; gap: 2px; margin-bottom: 10px; }
        .bar { flex: 1; background: var(--accent); opacity: 0.5; transition: height 0.5s; }
        .bar.up { background: var(--success); opacity: 0.8; } .bar.down { background: var(--danger); opacity: 0.8; }
        .market-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .m-btn { padding: 10px; border: none; border-radius: 6px; color: white; cursor: pointer; font-weight: bold; }
        .buy-stk { background: var(--success); } .sell-stk { background: var(--danger); }
        .m-btn:disabled { opacity: 0.3; }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 99; }
        .modal { background: var(--bg-panel); padding: 30px; border-radius: 12px; width: 300px; border: 1px solid var(--border); }
        input { width: 100%; padding: 10px; background: var(--bg-app); border: 1px solid var(--border); color: white; margin: 10px 0; }

        @media(max-width:768px){ body{flex-direction:column; overflow-y:auto} .sidebar{width:100%; flex-direction:row; padding:15px;} .stats-box, .clicker-container{display:none} }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="brand">PAISER<span>CLICKER</span></div>
    <div class="stats-box">
        <div style="font-size:0.8rem; color:#aaa">BALANCE</div>
        <div class="stat-val" id="score">0</div>
        <div style="font-size:0.8rem; margin-top:5px">PPC: <span id="ppc">1</span></div>
        <div style="font-size:0.8rem">CPS: <span id="cps">0</span></div>
    </div>
    <div class="clicker-container"><button id="click-btn">CLICK</button></div>
    <button style="background:none; border:1px solid #333; color:#aaa; padding:8px; cursor:pointer" onclick="User.logout()">Logout / Save</button>
</aside>

<main class="main-view">
    
    <!-- Standard Upgrades -->
    <div class="card">
        <div class="card-header"><span>Infrastructure</span></div>
        <div id="shop-list" class="upgrade-list"></div>
    </div>

    <!-- Ascension Tech (Unlockable) -->
    <div class="card" id="ta-upgrades-card">
        <div class="card-header"><span style="color:var(--danger)">Ascension Tech</span> <span style="font-size:0.8rem">TA: <span id="ta-count">0</span></span></div>
        <div id="ta-shop-list" class="upgrade-list"></div>
    </div>

    <!-- Flux Dimension -->
    <div class="card" id="flux-card">
        <div class="card-header"><span style="color:var(--flux)">Flux Dimension</span> <span id="flux-bal">0 Flux</span></div>
        <p style="font-size:0.8rem; color:#888; margin-bottom:10px">Generate Flux instead of Coins (-90% prod).</p>
        <button id="flux-toggle" class="toggle-btn" onclick="Game.toggleFlux()">Enter Dimension</button>
        <div id="flux-shop-list" class="upgrade-list" style="height:150px"></div>
    </div>

    <!-- Market -->
    <div class="card">
        <div class="card-header"><span style="color:var(--success)">Void Market</span> <span id="stock-count">Owned: 0</span></div>
        <div style="font-size:1.5rem; font-weight:800; text-align:center" id="market-price">50 C</div>
        <div class="market-graph" id="market-graph"></div>
        <div class="market-btns">
            <button class="m-btn buy-stk" id="btn-buy-stk" onclick="Market.buy()">BUY</button>
            <button class="m-btn sell-stk" id="btn-sell-stk" onclick="Market.sell()">SELL</button>
        </div>
    </div>

    <!-- Evolution / Ascension -->
    <div class="card">
        <div class="card-header"><span style="color:#a855f7">Evolution</span> <span id="shard-bal">0 Shards</span></div>
        <div class="upgrade-item">
            <div><b>Evo Core</b> <small>x5 Base</small></div>
            <button id="btn-evo" class="btn-buy" onclick="Game.buyEvo()">Buy (5)</button>
        </div>
        <div style="margin-top:auto; padding-top:15px">
            <div id="ascend-info" style="text-align:center; font-size:0.8rem; color:#888; margin-bottom:5px">Reach 10B</div>
            <button id="btn-ascend" class="btn-buy" style="width:100%; background:#333" onclick="Game.ascend()">Prestige</button>
            
            <!-- TRUE ASCENSION TRIGGER -->
            <div id="ta-trigger" style="display:none; margin-top:15px; text-align:center; border-top:1px solid var(--danger); padding-top:10px;">
                <b style="color:var(--danger)">INFINITY REACHED</b>
                <p style="font-size:0.7rem; color:#888">Hard Mode Reset (500x Costs)</p>
                <button id="ta-btn" style="display:block" onclick="Game.trueAscend()">TRUE ASCEND</button>
            </div>
        </div>
    </div>

</main>

<div id="auth-modal" class="modal-overlay" style="display:flex">
    <div class="modal">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Codename">
        <button class="btn-buy afford" style="width:100%; padding:10px" onclick="User.login()">Start</button>
    </div>
</div>

<script>
/* CONFIG */
const CFG = { tick: 100, ascReq: 1e10, infCap: 1e300 };
let D = { score:0, flux:0, shards:0, stocks:0, evoLvl:0, ta:0, ups:[0,0,0,0,0,0], fluxUps:[0,0], taUps:[0,0] };
let fluxActive = false;

/* DATA */
const UPS = [
    { name:'Cursor', base:15, val:1, type:'ppc' },
    { name:'Auto-Clicker', base:100, val:1, type:'cps' },
    { name:'Server Farm', base:2000, val:20, type:'cps' },
    { name:'AI Core', base:50000, val:200, type:'cps' },
    { name:'Dyson Sphere', base:1e15, val:10, type:'dyson' },
    { name:'Omega Node', base:1e21, val:500, type:'dyson' }
];
const FLUX_UPS = [
    { name:'Flux Capacitor', base:10, val:1.5 },
    { name:'Time Dilator', base:50, val:2.0 }
];
// THE MISSING ASCENSION UPGRADES RESTORED
const TA_UPS = [
    { name:'Dark Matter Engine', base:1e12, val:1000, desc:'x1000 Global' },
    { name:'Void Siphon', base:1e20, val:10000, desc:'x10000 Global' }
];

/* MARKET LOGIC */
const Market = {
    price: 50, history: [50,50,50,50,50,50,50,50], tick:0,
    update() {
        this.tick++; if(this.tick<20) return; this.tick=0;
        this.price = Math.max(10, Math.min(500, this.price + (Math.random()-0.5)*20));
        this.history.push(this.price); if(this.history.length>8) this.history.shift();
        this.render();
    },
    render() {
        document.getElementById('market-price').innerText = Math.floor(this.price) + ' C';
        document.getElementById('market-graph').innerHTML = this.history.map(p=>`<div class="bar ${p>=this.history[0]?'up':'down'}" style="height:${(p/500)*100}%"></div>`).join('');
    },
    buy() { if(D.score>=this.price){ D.score-=this.price; D.stocks++; UI.update(); } },
    sell() { if(D.stocks>0){ D.score+=this.price; D.stocks--; UI.update(); } }
};

/* CORE */
function getCost(def, count, mode) {
    let cost = def.base * Math.pow(1.5, count);
    // Hard Mode Logic
    if(mode !== 'flux' && D.ta > 0) cost *= (def.type==='dyson' || mode==='ta') ? 500 : 5;
    return cost;
}

function calc() {
    let ppc=1, cps=0;
    UPS.forEach((u,i) => { if(u.type==='ppc') ppc+=u.val*D.ups[i]; if(u.type==='cps') cps+=u.val*D.ups[i]; });
    
    let evo = (D.ta>0) ? 1.5 : Math.pow(5, D.evoLvl);
    let fluxM = 1; FLUX_UPS.forEach((u,i)=> fluxM *= Math.pow(u.val, D.fluxUps[i]));
    let dysonM = 1; UPS.forEach((u,i)=> { if(u.type==='dyson') dysonM *= Math.pow(u.val, D.ups[i]); });
    let taM = 1; TA_UPS.forEach((u,i)=> taM *= Math.pow(u.val, D.taUps[i]));

    let tPPC = ppc * evo * fluxM * dysonM * taM;
    let tCPS = cps * evo * fluxM * dysonM * taM;
    
    if(fluxActive) { tPPC*=0.1; tCPS*=0.1; }
    return { ppc:tPPC, cps:tCPS };
}

const Game = {
    buy(i, mode) {
        let list, counts, res;
        if(mode==='flux'){ list=FLUX_UPS; counts=D.fluxUps; res='flux'; }
        else if(mode==='ta'){ list=TA_UPS; counts=D.taUps; res='score'; }
        else { list=UPS; counts=D.ups; res='score'; }
        
        const cost = getCost(list[i], counts[i], mode);
        if(D[res] >= cost) { D[res]-=cost; counts[i]++; UI.update(); }
    },
    toggleFlux() { fluxActive=!fluxActive; document.getElementById('flux-toggle').classList.toggle('active', fluxActive); document.getElementById('flux-card').classList.toggle('active', fluxActive); },
    buyEvo() { if(D.ta===0 && D.shards>=5){ D.shards-=5; D.evoLvl++; UI.update(); } },
    ascend() {
        if(D.score<CFG.ascReq) return;
        D.shards += Math.floor(Math.sqrt(D.score/CFG.ascReq));
        D.score=0; D.stocks=0; D.ups.fill(0);
        fluxActive=false; Game.toggleFlux(); fluxActive=false;
        UI.update();
    },
    trueAscend() {
        if(D.score<CFG.infCap) return;
        D.ta++; D.score=0; D.flux=0; D.shards=0; D.evoLvl=0; D.stocks=0;
        D.ups.fill(0); D.fluxUps.fill(0); D.taUps.fill(0);
        User.save(); location.reload();
    },
    tick() {
        const s = calc();
        D.score += s.cps * (CFG.tick/1000);
        if(fluxActive && s.cps>0) D.flux += Math.sqrt(s.cps)*(CFG.tick/1000)/5;
        
        // Infinity Cap
        if(D.ta===0 && D.score >= CFG.infCap) { D.score = CFG.infCap; document.getElementById('ta-trigger').style.display='block'; }
        else document.getElementById('ta-trigger').style.display='none';

        Market.update();
        UI.update(s);
    }
};

const UI = {
    init() {
        const builder = (l, m, id) => document.getElementById(id).innerHTML = l.map((u,i)=>`
            <div class="upgrade-item">
                <div><b>${u.name}</b> <small>x${m==='flux'?D.fluxUps[i]:(m==='ta'?D.taUps[i]:D.ups[i])}</small><br><small id="${m}c${i}"></small></div>
                <button id="${m}b${i}" class="btn-buy" onclick="Game.buy(${i}, '${m}')">Buy</button>
            </div>`).join('');
        builder(UPS, 'std', 'shop-list');
        builder(FLUX_UPS, 'flux', 'flux-shop-list');
        builder(TA_UPS, 'ta', 'ta-shop-list');
    },
    fmt(n) { return n>=1e300 ? "âˆž" : (n<1000 ? Math.floor(n) : n.toExponential(2)); },
    update(s) {
        if(!s) s=calc();
        document.getElementById('score').innerText = this.fmt(D.score);
        document.getElementById('ppc').innerText = this.fmt(s.ppc);
        document.getElementById('cps').innerText = this.fmt(s.cps);
        document.getElementById('flux-bal').innerText = Math.floor(D.flux)+' Flux';
        document.getElementById('shard-bal').innerText = D.shards+' Shards';
        document.getElementById('stock-count').innerText = 'Owned: '+D.stocks;
        document.getElementById('ta-count').innerText = D.ta;

        // Update Buttons
        const chk = (l, m, cts, res) => l.forEach((u,i)=>{
            const c = getCost(u, cts[i], m);
            document.getElementById(m+'c'+i).innerText = (m==='flux'?Math.floor(c):this.fmt(c)) + (m==='flux'?' Flux':' C');
            const b = document.getElementById(m+'b'+i);
            if(res>=c) b.classList.add('afford'); else b.classList.remove('afford');
        });
        chk(UPS, 'std', D.ups, D.score);
        chk(FLUX_UPS, 'flux', D.fluxUps, D.flux);
        chk(TA_UPS, 'ta', D.taUps, D.score);

        // Special Buttons
        const eb = document.getElementById('btn-evo');
        if(D.ta>0){ eb.innerText="LOCKED (TA)"; eb.classList.remove('afford'); }
        else { eb.classList.toggle('afford', D.shards>=5); }

        const ab = document.getElementById('btn-ascend');
        if(D.score>=CFG.ascReq) { ab.classList.add('afford'); document.getElementById('ascend-info').innerText = `Reward: ${Math.floor(Math.sqrt(D.score/CFG.ascReq))} Shards`; }
        else { ab.classList.remove('afford'); document.getElementById('ascend-info').innerText = `Reach ${this.fmt(CFG.ascReq)}`; }
        
        document.getElementById('btn-buy-stk').disabled = D.score < Market.price;
        document.getElementById('btn-sell-stk').disabled = D.stocks <= 0;

        if(D.ta>0) {
            document.body.classList.add('true-ascension-mode');
            document.getElementById('ta-upgrades-card').style.display = 'flex';
        }
    }
};

const User = {
    login() {
        const u = document.getElementById('username').value;
        if(u){
            const db = JSON.parse(localStorage.getItem('paiser_v3')||'{}');
            if(db[u]) D = db[u];
            // Fix Array Lengths if outdated
            while(D.ups.length < UPS.length) D.ups.push(0);
            while(D.fluxUps.length < FLUX_UPS.length) D.fluxUps.push(0);
            if(!D.taUps) D.taUps = [0,0];
            
            document.getElementById('auth-modal').style.display='none';
            UI.init(); setInterval(Game.tick, CFG.tick); setInterval(User.save, 5000);
        }
    },
    save() { const u=document.getElementById('username').value; const db=JSON.parse(localStorage.getItem('paiser_v3')||'{}'); db[u]=D; localStorage.setItem('paiser_v3', JSON.stringify(db)); },
    logout() { this.save(); location.reload(); }
};

document.getElementById('click-btn').onmousedown = () => { D.score+=calc().ppc; UI.update(); document.getElementById('click-btn').style.transform='scale(0.95)'; setTimeout(()=>document.getElementById('click-btn').style.transform='scale(1)',50); };
</script>
</body>
</html>
